name: Run command via SSH every day or on workflow dispatch
on:
  schedule:
    - cron: '0 0 * * *' # runs at 12:00 AM UTC every day
  workflow_dispatch:

jobs:
  run-command:
    runs-on: ubuntu-latest
    steps:
      - name: Run command via SSH
        run: |
          sudo apt update
          sudo apt install tmux -y
          tmux new-session -s ghactions -d 'bash -c "ssh -o \"SetEnv SECRET=${{ secrets.SEGFAULT_TOKEN }}\" root@lulz.segfault.net \"cd dumper_bot && ./start.sh --restart\"; exec bash"'
          tmux send-keys -t ghactions 'segfault' Enter
